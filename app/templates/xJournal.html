{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html"as macros %}

{% block head %}
    {{ super() }}
    <!-- 确认删除窗口 -->
    <script type="text/javascript">
        function ComfirmDelete() {
            $('#deleteToggle').modal();
        }
    </script>
    <style type="text/css">
    p {white-space: pre-line;}
    </style>
{% endblock %}<!--先执行父模板-->

{% block title %}实习日志{% endblock %}

{% block page_content %}
      <!-- 删除确认窗口 -->
    <div class="modal fade" id="deleteToggle" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="text-align:center;">
                    <h4 class="modal-title" style="color:black;" id="deleteModalLabel">提示</h4>
            </div>
            <div class="modal-body">
                <h4 class="modal-body" style="color:red;" id="deleteModalLabel">日志将会连同实习信息一起删除,且删除操作将无法撤回,是否仍要删除</h4>
            </div>
            <div class="modal-footer">
                <!-- 用form来获取数据 -->
                <form action="/intern_delete" method="POST">
                <input type="hidden" name="internId" value="{{ internship.Id }}">
                <input type="hidden" name="from_url" value="xJournal">
                <input type="hidden" name="stuId" value="{{ student.stuId }}">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="submit" class="btn btn-primary" >删除</button>
                </form>
            </div>
        </div>
    </div>
    </div>

    <div class="page-`er">
    {% if current_user.roleId==0 %}
        <h1>我的实习日志
    {% else %}
        <h1>{{ student.stuName }}的实习日志
    {% endif %}
            <div class="btn-group">
                <button type="button" class="btn btn-default dropdown-toggled btn-sm"
                        data-toggle="dropdown">编辑<span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    {% for jour in journal %}
                        {% if current_user.roleId == 0 and jour.jourCheck == 0 %}
                            <li><a href="{{ url_for('.xJournalEdit', jourId=jour.Id, stuId=student.stuId, comId=comInfor.comId, internId=internship.Id) }}">编辑日志</a></li>
                            <li class="divider" />
                        {% endif %}
                        {% if current_user.roleId == 3 %}
                            <li><a href="{{ url_for('.xJournalEdit', jourId=jour.Id, stuId=student.stuId, comId=comInfor.comId, internId=internship.Id) }}">编辑日志</a></li>
                            <li class="divider" />
                        {% endif %}
                    {% endfor %}
                    <li><a onClick="ComfirmDelete()">删除</a></li>
                </ul>
            </div>
        </h1>

    <!-- 日志总体审核情况 -->
    {% if internship.jourCheck == 0 %}
        <span class="label label-warning">待审核...</span>
    {% else %}
        <span class="label label-info">已审核</span>
    {% endif %}
        <br><br>



    </div>
    <table align="center" border="2" class="table-bordered">
        <tr>
            <th width="200">学号</th>
            <td width="400" height="50">{{ student.stuId }}</td>
            <th width="200">专业班级</th>
            <td width="400" height="50">{{ student.major }}{{ student.classes }}班</td>
        </tr>
        <tr>
            <th width="200">姓名</th>
            <td width="400" height="50">{{ student.stuName }}</td>
            <th width="200">实习单位</th>
            <td width="400" height="50">{{ comInfor.comName }}</td>
        </tr>
        <tr>
            <th width="200">实习期间</th>
            <td height="50">{{ internship.start }} 至 {{ internship.end }} </td>
        </tr>
    </table>
    <br>
    <table align="center" border="2" class="table-bordered">

        {% set weekday2ch = {1:'一', 2:'二', 3:'三', 4:'四', 5:'五', 6:'六', 7:'七'} %}
        {% for jour in journal %}
                {% set cur = jour.workStart.isoweekday() %}
                {% set cur_end = jour.workEnd.isoweekday() %}
                <tr>
                    <th width="200" height="50">第{{ jour.weekNo }}周
                    {% if now >= jour.workStart and now <= jour.workEnd %}
                    <span class="label label-info">待更新...</span>
                    {% elif now > jour.workEnd %}
                        {% if jour.jourCheck == 0 %}
                            <span class="label label-warning">待审核...</span>
                        {% elif jour.jourCheck == 1 %}
                            <span class="label label-info" >已审核</span>
                        {% endif %}
                    {% endif %}

                    </th>
                    <th width="100" height="50">星期</th>
                    <th width="900" height="50">工作内容                    
                </tr>
                {% if cur==1 and cur_end==7 %}
                    <tr>
                        <th height="50">{{ jour.workStart }}至{{ jour.workEnd }}</th>
                        <td height="50">一</td>
                        <td height="50"><p>{{ jour.mon }}</p></td>
                    </tr>
                    <tr>
                        <th></th>
                        <td height="50">二</td>
                        <td height="50"><p>{{ jour.tue }}</p></td>
                    </tr>
                    <tr>
                        <th></th>
                        <td height="50">三</td>
                        <td><p>{{ jour.wed }}</p></td>
                    </tr>
                    <tr>
                        <th></th>
                        <td height="50">四</td>
                        <td><p>{{ jour.thu }}</p></td>
                    </tr>
                    <tr>
                        <th></th>
                        <td height="50">五</td>
                        <td><p>{{ jour.fri }}</p></td>
                    </tr>
                    <tr>
                        <th></th>
                        <td height="50">六</td>
                        <td><p>{{ jour.sat }}</p></td>
                    </tr>
                    <tr>
                        <th></th>
                        <td height="50">日</td>
                        <td><p>{{ jour.sun }}</p></td>
                    </tr>
                {% else %}
                {% set weekday2var = {1:jour.mon, 2:jour.tue, 3:jour.wed, 4:jour.thu, 5:jour.fri, 6:jour.   sat, 7:jour.sun} %}
                    <tr>
                        <th height="50">{{ jour.workStart }}至{{ jour.workEnd }}</th>
                        <td height="50">{{ weekday2ch[cur] }}</td>
                        <td height="50"><p>{{ weekday2var[cur] }}</p></td>
                    </tr>
                    {% set cur_last = (jour.workEnd.isoweekday() - jour.workStart.isoweekday()) %}
                    {% for x in range(cur_last) %}
                        <tr>
                            <th></th>
                            <td height="50">{{ weekday2ch[cur+x+1] }}</td>
                            <td height="50"><p>{{ weekday2var[cur+x+1] }}</p></td>
                        </tr>
                    {% endfor %}
                {% endif %}
        {% endfor %}
    </table>

    {% if pagination %}
        <div class="pagination">
            {{ macros.pagination_widget(pagination, '.xJournal',stuId=student.stuId, internId=internship.Id) }}
        </div>
    {% endif %}

    <br><a href="{{ url_for('.stuJournalList') }}"><div class="btn btn-primary">返回&nbsp;</div></a>
    {% for jour in journal %}
        {% if jour.jourCheck == 0 and current_user.can(Permission.STU_JOUR_CHECK) and now > jour.workEnd %}
                    <a href="{{ url_for('.journal_comfirm', jourId=jour.Id, stuId=student.stuId, internId=internship.Id) }}"><button class="btn btn-success">点击这里，通过这周日志的审核</button></a>
        {% endif %}
    {% endfor %}
{% endblock %}
